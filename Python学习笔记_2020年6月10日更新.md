# Python学习笔记

---

这篇笔记在日常教学中总结出来，存在各种不足之处，不知道什么时候能够完善。

## Python三大金句

- **Python之中，万物皆对象**
- **式、值等价**
- **Python代码从上到下依次执行**

## Python六大基础数据类型

### 不可变对象

- 数字类型
  - 整数类型(int)
  - 浮点数类型(float)
  - 复数类型(complex)

- 字符串(string, str)

  十分重要的数据类型，必须至少熟练掌握以下知识点：

  - .find()
  - .rfind()
  - .strip()
  - .split()
  - .replace()
  - .join()
  - 索引操作
  - 切片操作
  - 字符串的级联
  - 格式化输出
  - 特殊字符(\n, \\\\, \\', \\" 等)

- 元组(tuple)

### 可变对象

- 列表(list)

  十分重要的数据类型，必须能够用得~~出神入化~~十分熟练：

  - .append()
  - .remove()
  - .insert()
  - .pop()
  - .index()
  - 索引操作
  - 遍历操作

- 集合(set)

- 字典(dictionary, dict)

  十分重要的数据类型，必须用得~~炉火纯青~~得心应手：

  - .get()
  - 索引操作

### 区分可变对象和不可变对象的意义

> 不可变对象在赋值的时候，变量会得到一个**副本**；可变对象在赋值的时候，变量会得到一个**引用**。

上面这句话在任何情况下**都有效**。

---

## 全局变量

作用于全局的变量，通常用来描述整个程序的行为模式。当我们需要在其他代码块中访问或修改全局变量时，需要在代码块中声明：

```python
global variable
```



---

## 条件控制

if, elif, else 语句

基本格式：

```python
if condition_1:
	code_block1
elif condition_2:
	code_block2
else:
	code_block3
```

if 可以单独存在，但 elif 和 else 必须在 if 后面。

## 循环

- while 循环

  - 显式书写循环条件

  - while 后面的条件语句每次都会被执行

    ```python
    while cond:
    	statement
    ```

    

- for 循环

  - 隐式书写循环条件

  - for 后面的变量将会被一个可迭代对象中的每个元素**依次**赋值

    ```python
    for element in iterable_object:
    	statement
    ```

    

使用 break 关键字来结束**当前的**循环。

- 当前的循环是指，最小的、能将这个 break 包含的循环代码块。

while 和 for 循环绝大多数情况下都可以相互替代，需要根据具体情况进行选择。

---

while, for, if 语句可以相互*嵌套*。

嵌套的代码必须使用缩进进行**代码块**的分段。

识别一个代码块是无比重要的能力，如果无法识别代码块，你最好现在就 exit()，因为接下来的一切都对你的身体有害。

---

## 练习：猜数字游戏

简述：系统默默生成一个数字（1~100），用户猜数字，每次猜错都会缩小范围，直到猜中，游戏结束。

游戏需要解决的问题：

- 怎么生成随机数
  - 使用python内置的库实现：import random
- 用户输入如何处理
  - 使用 input() 函数让用户输入一个字符串
  - int() 函数将用户的字符串转化为整数
- 如何判断用户输入是否正确
  - 使用 if 判断用户输入是否正确
- 如何缩小范围
  - 使用 max 和 min 两个变量来表示范围
  - 使用 if 判断应该更新最大值还是最小值
- 用户不知道需要花多少次才会猜中
  - 使用 while True 进行无限循环
  - 当用户猜中时，使用 break 结束当前游戏

请补全代码：

```python
# number guessing
import random
# get a random number in between 1~100
key = random.randint(1, 101)

# your turn!

# initialize the range of guessing

# ask user to guess a number in the range. 
# notice that input() returns string. int() is necessary for type cast

# if user get the right key:
# 	show congrats to user

# else:
# 	shrink the range
# 	ask user to guess again in shrinked range, until getting right answer.


```

为了不在写代码的时候迷失自我，总是写文档，写注释。

---

## 函数的定义与调用

### 定义函数的基本格式

```python
def function_name(parameters):
	function body
	[return ]
```

### 调用函数的基本格式

```python
function_name(arguments)
```

### 术语及概念

- 调用(call)：调用函数的本质是，使用**实际参数**为**形式参数**进行赋值，然后做**代码跳转**。
- 形式参数(parameter)：**定义**函数时，指定的参数列表中的参数即为形式参数。形式参数在函数被调用之前，没有值。
- 实际参数(argument)：**调用**函数时，填入到参数列表中的参数即为实际参数。实际参数在函数被调用前，一定有值。
- 函数栈：函数栈是函数在被调用时，进行代码跳转**之前**，由系统分配的一块内存，这块内存被用于存放函数代码块，和传入的参数。函数栈会在函数**执行完毕**或**函数返回时**，被系统回收并销毁。
- 函数的返回值：当函数栈被回收销毁时，系统预留一块内存，这块内存保存着一个值，这个值就是返回值，它可以被函数的调用者访问。
- 参数传递
  - 参数的传递本质上就是**赋值的过程**，因此也会受到可变对象与不可变对象的赋值特性的约束。即，实际参数为可变对象时，形式参数获得实际参数的引用；为不可变对象时，形式参数获得实际参数的副本。

  - 位置参数(positional arguments)：需要按照顺序传入的参数。

  - 默认参数(default arguments)：当该参数没有对应的实际参数为之赋值时，能够使用指定的默认值的位置参数。

    - 注意，默认参数必须在所有非默认参数的位置参数之后。

    - 注意区分默认参数和关键字参数，由于二者的形式相同，你需要根据它们的**出现位置**来判断它到底是作为*默认参数的形式参数*，还是作为*关键字参数的实际参数*。

      ```python
      def func(position_arg, default_art="default value"):
          ...
      ```

      

  - 列表参数(list arg)：这是一种特殊的参数**表示方式**，写作 *list_arg。这表示，参数将会以列表形式传入。

    ```python
    def func(*larg):
        print(larg[3])
    
    func(1, 2, 3, 4)  # --> output: 4
    ```

  - 关键字参数(keyword arg)：这是一种特殊的参数**表示方式**，写作 **kwarg。这表示，参数将会以关键字方式传入。

    ```python
    def func(**kwarg):
        print(kwarg["key"])
    
    func(key=2, useless_arg=3)  # --> output: 2
    ```

    

  - 上述参数的优先级：
    1. 位置参数(非默认参数)
    2. 默认参数
    3. 列表参数
    4. 关键字参数

### 关于函数定义的习惯

函数的作用是对代码块进行封装，提高代码的*复用性*，减少代码量，减小程序的体积，减小维护代码的难度。

但是，定义函数应当遵守一些规则，遵守这些规则将会为程序排错、代码维护提供极大裨益。

- 函数名最好要能够望文生义，这意味着：
  - 你的函数名应当具有**具体的**含义。data_process(data)就是一个极其糟糕的例子。具体的例子应该是 get_process_id()。
  - 函数名应当遵循特定的格式，这种格式不应与变量、类相冲突。python约定俗成的函数名称规范是：只使用小写字母，单词之间使用下划线分割。
- 函数的功能最好能够用一句话说完。不应在一个函数中，完成多项任务。
- 定义函数时，一定要指出函数的返回值的数据类型
  - 函数文档：函数定义语句下，使用"""括起来的字符串。这个字符串会在常用的IDE中被自动显示。
  
  - 函数文档应当描述该函数的行为，参数的意义，返回值的意义。
  
    ```python
    def func():
        """
        here is where you put your function's doc
        """
        ...
    ```
  
- 定义函数时，建议给出接收参数的类型
  - 指定参数类型：在形式参数后加 : \[数据类型]
  
  - 注意，数据类型必须在函数**被定义时**是已知的。
  
  - 指定的参数类型只是建议，实际传入参数的数据类型可以不遵守建议。
  
    ```python
    def func(some_string_type_arg: str):
        """
        accept str type.
        
        if you make other type, it won't complain at the moment when it's called.
        what would happen after jumping is not guaranteed.
        
        notice that the type you advised must be defined type at the time you define this function.
        """
        ...
    ```
  
- ==递归函数==
  
  - 先欠着
- ==回调函数==
  
  - 先欠着

---

## 手写爬虫

使用Python的基本姿势和函数实现一个自动爬取小说的爬虫。

#### 技术栈

- 发送http[^1]请求
  - 使用 requests 库实现。
- 处理http响应
  - 掌握二进制文件的解码
- 解析html网页代码
  - 初步理解HTML代码的特点
- 数据清洗
  - 使用*正则表达式*进行数据清洗和提取
- 提取目标数据
  - BeautifulSoup 实现 html 快速提取
- 数据的本地化(持久化)
  - 使用 open() 进行本地数据写入

#### 程序事件流

- 获取初始URL[^2]
- 向服务器发送http请求，获取小说目录页面响应
- 解析小说目录页面，构造章节地址列表
- 构造章节页面请求
- 依次向服务器发送各章节http请求并接收响应
- 解析各章节的响应，提取章节数据
- 将数据本地化

---

## 附加内容

在附加内容中会加入关于 Python 编程过程中的细节问题，这些细节大概**不会包括**面向对象相关的内容。





### 写好一个函数

Python 好用，但用好很难。如果不能写出规范的函数，对于自己和他人都没有好处。糟糕的函数千奇百怪，但是好函数有一些共性。

- 命名合理
- 单一功能
- 包括文档字符串
- 返回一个值
- 不超过50行
- 是幂等函数或纯函数

#### 命名合理

> 计算机科学中只有两件事让人头痛：缓存失效和命名。

合理命名的函数能够让人望文生意一看就懂，从而大幅提高代码可读性，降低维护难度。

以下是一些需要注意的情况：

- 对于不常见的事物，不要使用缩写。

  使用缩写的唯一目的就是少打几个字，事实上所有的现代开发环境都支持自动补全，根本没有必要使用缩写。

- 函数名称与它的返回值不相关，或者函数名难以描述函数的返回值。

  事实上不仅是函数名，形式参数表也应当尽量准确描述每个参数的作用。

#### 单一功能

单一功能原则并不仅仅是对函数而言，类和模块也应当遵守这个原则。这么做的原因是，如果每个函数都只做了一件事，那么当且仅当这件事发生变化，才需要修改这个函数——如果这件事都不需要再做了，那就干脆删了它。

---

### 包

随着程序复杂度的提高，代码的管理也越来越重要，将不同功能的代码分别放进不同的文件以方便管理，我们将这样的对象称为模块。

需要注意的是，包的结构比较复杂，而Python解释器在处理它们的时候，有很多令人疑惑的行为，我在这里仅仅只能告诉你怎么做不会出错，但是我没法告诉你正确的做法(因为我也不会)。











[^1]: Hyper Text Transport Protocol, 超文本传输协议
[^2]: Universal Resource Label, 统一资源定位符